<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Workout Schedule</title>
    <link rel="stylesheet" href="../dark-theme.css">
    <link rel="stylesheet" href="workout.css">
    <script src="workout-utils.js"></script>
</head>
<body>
    <div class="nav-bar">
        <a href="../index.html">Home</a>
        <a href="workout.html">Today's Workout</a>
        <a href="workout_routine.html">Workout Routines</a>
        <a href="set_workout_day.html">Schedule</a>
    </div>
    
    <div class="container">
        <h1>Set Your Workout Schedule</h1>
        
        <!-- Schedule Type Toggle -->
        <div class="schedule-toggle">
            <button id="cycle-toggle" class="active" onclick="switchScheduleType('cycle')">
                üîÑ Cycle Schedule (Day 1, Day 2, etc.)
            </button>
            <button id="weekly-toggle" onclick="switchScheduleType('weekly')">
                üìÖ Weekly Schedule (Mon, Tue, etc.)
            </button>
        </div>

        <!-- Cycle-Based Schedule Section -->
        <div id="cycle-schedule-section" class="schedule-section active">
            <div class="info-box">
                <h4>About Cycle Schedules</h4>
                <p>Cycle schedules are flexible and not tied to specific days of the week. Perfect for:</p>
                <ul>
                    <li>Variable workout schedules</li>
                    <li>Progressive training programs</li>
                    <li>3-day, 4-day, 5-day, or custom workout splits</li>
                </ul>
            </div>

            <!-- Cycle Settings -->
            <div class="cycle-settings">
                <h3>‚öôÔ∏è Cycle Configuration</h3>
                <div class="cycle-settings-grid">
                    <label for="cycleLength">Cycle Length:</label>
                    <input type="number" id="cycleLength" min="1" max="7" value="4">
                    
                    <label for="currentCycle">Current Cycle #:</label>
                    <input type="number" id="currentCycle" min="1" value="1">

                    <div class="day-name-inputs" id="dayNameInputs">
                        <!-- Dynamic day name inputs will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Cycle Day Assignments -->
            <form id="cycleForm">
                <!-- Dynamic cycle day selects will be generated here -->
            </form>
        </div>

        <!-- Weekly Schedule Section -->
        <div id="weekly-schedule-section" class="schedule-section">
            <div class="info-box">
                <h4>About Weekly Schedules</h4>
                <p>Weekly schedules assign routines to specific days of the week. Perfect for:</p>
                <ul>
                    <li>Consistent weekly schedules</li>
                    <li>Traditional workout splits (e.g., Monday = Chest Day)</li>
                    <li>Working around specific weekly commitments</li>
                </ul>
            </div>

            <form id="workoutForm">
                <label for="Monday">Monday:</label>
                <select id="Monday"></select>

                <label for="Tuesday">Tuesday:</label>
                <select id="Tuesday"></select>

                <label for="Wednesday">Wednesday:</label>
                <select id="Wednesday"></select>

                <label for="Thursday">Thursday:</label>
                <select id="Thursday"></select>

                <label for="Friday">Friday:</label>
                <select id="Friday"></select>

                <label for="Saturday">Saturday:</label>
                <select id="Saturday"></select>

                <label for="Sunday">Sunday:</label>
                <select id="Sunday"></select>
            </form>
        </div>

        <button class="btn" onclick="saveWorkoutSchedule()">Save Schedule</button>
        <button class="btn" onclick="window.location.href='workout_routine.html'">Create/Edit Workout Routines</button>
    </div>

    <script>
        let currentScheduleType = 'cycle';

        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            populateRoutines();
            setupCycleLengthListener();
        });

        function loadSettings() {
            const settings = WorkoutUtils.getSettings();
            const schedule = WorkoutUtils.getSchedule();
            
            // Load schedule type
            currentScheduleType = schedule.type || 'cycle';
            switchScheduleType(currentScheduleType, false);
            
            // Load cycle settings
            document.getElementById('cycleLength').value = settings.cycleLength || 4;
            document.getElementById('currentCycle').value = settings.currentCycle || 1;
            
            // Generate day name inputs
            generateDayNameInputs(settings.cycleLength || 4);
            
            // Load day names
            if (settings.cycleDayNames) {
                settings.cycleDayNames.forEach((name, index) => {
                    const input = document.getElementById(`dayName-${index + 1}`);
                    if (input) input.value = name;
                });
            }
            
            // Generate cycle day selects
            generateCycleDaySelects(settings.cycleLength || 4);
        }

        function setupCycleLengthListener() {
            document.getElementById('cycleLength').addEventListener('change', function() {
                const newLength = parseInt(this.value);
                generateDayNameInputs(newLength);
                generateCycleDaySelects(newLength);
            });
        }

        function generateDayNameInputs(length) {
            const container = document.getElementById('dayNameInputs');
            container.innerHTML = '';
            
            const settings = WorkoutUtils.getSettings();
            
            for (let i = 1; i <= length; i++) {
                const div = document.createElement('div');
                div.className = 'day-name-input';
                
                const label = document.createElement('label');
                label.textContent = `Day ${i} Name:`;
                label.htmlFor = `dayName-${i}`;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `dayName-${i}`;
                input.placeholder = `Day ${i}`;
                input.value = settings.cycleDayNames?.[i-1] || `Day ${i}`;
                
                div.appendChild(label);
                div.appendChild(input);
                container.appendChild(div);
            }
        }

        function generateCycleDaySelects(length) {
            const form = document.getElementById('cycleForm');
            form.innerHTML = '';
            
            const settings = WorkoutUtils.getSettings();
            const schedule = WorkoutUtils.getSchedule();
            
            for (let i = 1; i <= length; i++) {
                const dayName = settings.cycleDayNames?.[i-1] || `Day ${i}`;
                
                const label = document.createElement('label');
                label.htmlFor = `cycleDay-${i}`;
                label.textContent = `${dayName}:`;
                
                const select = document.createElement('select');
                select.id = `cycleDay-${i}`;
                populateSelect(select);
                
                // Set selected value if exists
                if (schedule.cycleDays && schedule.cycleDays[i]) {
                    select.value = schedule.cycleDays[i];
                }
                
                form.appendChild(label);
                form.appendChild(select);
            }
        }

        function populateRoutines() {
            // Populate weekly schedule
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const schedule = WorkoutUtils.getSchedule();
            
            days.forEach(day => {
                const select = document.getElementById(day);
                if (select) {
                    populateSelect(select);
                    // Set selected option based on saved schedule
                    if (schedule.weekly && schedule.weekly[day]) {
                        select.value = schedule.weekly[day];
                    }
                }
            });
        }

        function populateSelect(select) {
            const routines = WorkoutUtils.getRoutines();
            select.innerHTML = '<option value="">Rest Day / No Workout</option>';
            
            for (const routineName in routines) {
                const option = document.createElement('option');
                option.value = routineName;
                option.textContent = routineName;
                select.appendChild(option);
            }
        }

        function switchScheduleType(type, save = true) {
            currentScheduleType = type;
            
            // Update toggle buttons
            document.getElementById('cycle-toggle').classList.toggle('active', type === 'cycle');
            document.getElementById('weekly-toggle').classList.toggle('active', type === 'weekly');
            
            // Show/hide sections
            document.getElementById('cycle-schedule-section').classList.toggle('active', type === 'cycle');
            document.getElementById('weekly-schedule-section').classList.toggle('active', type === 'weekly');
            
            if (save) {
                const schedule = WorkoutUtils.getSchedule();
                schedule.type = type;
                WorkoutUtils.saveSchedule(schedule);
            }
        }

        function saveWorkoutSchedule() {
            const settings = WorkoutUtils.getSettings();
            const schedule = WorkoutUtils.getSchedule();
            
            // Save schedule type
            schedule.type = currentScheduleType;
            
            if (currentScheduleType === 'cycle') {
                // Save cycle settings
                const cycleLength = parseInt(document.getElementById('cycleLength').value);
                const currentCycle = parseInt(document.getElementById('currentCycle').value);
                
                settings.cycleLength = cycleLength;
                settings.currentCycle = currentCycle;
                
                // Save day names
                const dayNames = [];
                for (let i = 1; i <= cycleLength; i++) {
                    const input = document.getElementById(`dayName-${i}`);
                    dayNames.push(input ? input.value : `Day ${i}`);
                }
                settings.cycleDayNames = dayNames;
                
                // Save cycle day assignments
                schedule.cycleDays = {};
                for (let i = 1; i <= cycleLength; i++) {
                    const select = document.getElementById(`cycleDay-${i}`);
                    if (select && select.value) {
                        schedule.cycleDays[i] = select.value;
                    }
                }
            } else {
                // Save weekly schedule
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                schedule.weekly = {};
                
                days.forEach(day => {
                    const select = document.getElementById(day);
                    if (select && select.value) {
                        schedule.weekly[day] = select.value;
                    }
                });
            }
            
            // Save everything
            WorkoutUtils.saveSettings(settings);
            WorkoutUtils.saveSchedule(schedule);
            
            alert(`${currentScheduleType === 'cycle' ? 'Cycle' : 'Weekly'} schedule saved successfully!`);
        }
    </script>
</body>
</html>
